# 一个mvc服务器浏览器网络请求简要过程
## 从一个问题说起
电脑在有些时候，发现qq可以上，而浏览器却打不开网站？
这是因为qq是ip直连，而浏览器却需要DNS（域名系统）来查询域名地址相对应的ip,所以DNS设置错误就可能导致这种状况

## 访问一个网站三步走
1. http客户的端发起请求，创建端口,（request sent）阶段
2. htpp服务端在端口监听客户端请求，并根据请求内容进行操作生成内容，(waiting)阶段
3. http服务端向客户端返回状态和内容，（content download）阶段

## 访问一个网站数据流通的八步
1. 输入网址
2. 浏览器搜索自身的DNS缓存，如`Chrome//:dns`
3. 第2步没有找到，就读取本地host文件
4. 第3步没找到，浏览器解析器向DNS发起请求域名解析请求，完成后解析，此次步骤较为复杂，可以说的是DNS服务器有上万台，而且层级很多，在此省略
5. 拿到ip地址后，浏览器与服务器进行tcp/ip请求，进行三次握手成功后
6. 浏览器生成标准请求头，发送数据给服务端，请求头包括一些协议，方法和参数等
7. NGINX 到 后台程序；后台 controller 根据请求方法，路径，参数等，进行处理然后调用 model 层（操作数据库），通过 view 把结果生成响应头和页面，返回给浏览器
8. 浏览器根据拿到的资源进行渲染，生成DOM tree和css rule tree,在合并成渲染树进行绘制，也就是我们看到的网页

## 浏览器请求时间划分，Google Chrome浏览器一个正常的请求为例（Timing）
> Google Chrome f12 打开开发者工具，可以查看   network 中的请求详情，其中 timing 就是请求时间详情

#### 截图
![](https://tomz-1253937763.cos.ap-guangzhou.myqcloud.com/img/201904/timing.jpg)

#### 详解
##### 一：resource scheduling（资源调度）
1. Queueing：浏览器请求文件顺序的排序，浏览器有线程限制的，发请求也不能所有的请求同时发送，所以需要按照队列发送

##### 二：connect start（连接开始）
1. Stalled：一：TCP连接的检测过程，如果检测成功就会继续使用该TCP连接发送数据，如果检测失败就会重新建立TCP连接。所以出现stalled阶段过长，往往是丢包所致，这也意味着网络或服务端有问题；二：此外浏览器对同一个主机域名的并发连接数有限制，因此如果当前的连接数已经超过上限，那么其余请求就会被阻塞，等待新的可用连接；
2. Proxy Negotiation 与代理服务器连接的时间花费。
3. DNS Lookup 执行DNS查询的时间。网页上每一个新的域名都要经过一个DNS查询。第二次访问浏览器有缓存的话，则这个时间为0。
4. Initial Connection / Connecting 建立连接的时间花费，包含了TCP握手及重试时间。
5. SSL 完成SSL握手的时间花费。

##### 三：requset/response（请求和响应）
1. Request sent 发起请求的时间。
2. Waiting (Time to first byte (TTFB)) 是最初的网络请求被发起到从服务器接收到第一个字节这段时间，它包含了TCP连接时间，发送HTTP请求时间和获得响应消息第一个字节的时间。
3. Content Download 获取Response响应数据的时间花费。