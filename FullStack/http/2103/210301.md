
# http 的 keep-alive
> 基础;面试

http 1.1 相对于 htpp 1.0 支持持久连接(keep-alive);以及新的缓存协议: 强缓存(Cache-control),协商缓存(Etag)

## 为什么要有 Connection: keep-alive
在早期的 HTTP/1.0 中，每次 http 请求都要创建一个连接(三次请求四次挥手)，而创建连接的过程需要消耗资源和时间,有了 keep-alive 就不需要在连续请求中连续创建连接.请求中设定 Connection: keep-alive,来告诉对方这个请求响应完成后不要关闭，下一次咱们还用这个请求继续交流.例如短时连续请求: 1.js,2.js 就只要一次连接,可以处理多次请求了.

## 那么怎么结束这次请求呢
1. 如果是固定的静态文件,会有个特殊标志就是Content-Length，来指明响应体的数据大小，比如Content-Length: 120.表示响应体内容有120个字节，这样浏览器接收到120个字节的响应体后就知道了已经响应完成。
2. 如果是动态的内容,不能固定长度.这时候 Transfer-Encoding: chunked 响应头就派上用场了,该响应头表示响应体内容用的是分块传输,此时服务器可以将数据一块一块地分块响应给浏览器,当最后一个分块大小为零的数据传递给浏览器,响应体就结束了.
3. 当响应体结束,此时如果连接超过指定设置 keep-alive 时间间隔，服务端就会主动关闭连接。同时服务端还会设置一个参数叫最大请求数，比如当最大请求数是300时，只要请求次数超过300次，即使还没到超时时间，服务端也会主动关闭连接。
